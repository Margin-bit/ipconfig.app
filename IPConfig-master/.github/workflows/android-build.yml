name: Build Android APK

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Debug - Show directory structure
      run: |
        echo "=== 目录结构 ==="
        find . -type f -name "gradlew" 2>/dev/null
        echo "=== 列出所有 ==="
        ls -la
        echo "=== 子目录 ==="
        ls -la IPConfig-master/
    
    - name: Build APK
      working-directory: ./IPConfig-master  # 关键：进入子目录
      run: |
        echo "当前工作目录：$(pwd)"
        echo "gradlew文件："
        ls -la gradlew
        chmod +x gradlew
        ./gradlew assembleDebug --stacktrace
        
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: ipconfig-app
        path: IPConfig-master/app/build/outputs/apk/debug/*.apk  # 注意路径
